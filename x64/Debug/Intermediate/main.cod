; Listing generated by Microsoft (R) Optimizing Compiler Version 15.00.30729.207 

include listing.inc

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	DeviceHandle
_BSS	SEGMENT
DeviceHandle DQ	01H DUP (?)
_BSS	ENDS
PUBLIC	vtc_rdmsr
EXTRN	__imp_DeviceIoControl:PROC
;	COMDAT pdata
; File d:\projects\virtchk\virtchk\main.c
pdata	SEGMENT
$pdata$vtc_rdmsr DD imagerel $LN3
	DD	imagerel $LN3+101
	DD	imagerel $unwind$vtc_rdmsr
pdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$vtc_rdmsr DD 010801H
	DD	0a208H
; Function compile flags: /Odtp
xdata	ENDS
;	COMDAT vtc_rdmsr
_TEXT	SEGMENT
msr_value$ = 64
ret_len$ = 72
index$ = 96
vtc_rdmsr PROC						; COMDAT

; 7    : {

$LN3:
  00000	89 4c 24 08	 mov	 DWORD PTR [rsp+8], ecx
  00004	48 83 ec 58	 sub	 rsp, 88			; 00000058H

; 8    : 	u64 msr_value=0;

  00008	48 c7 44 24 40
	00 00 00 00	 mov	 QWORD PTR msr_value$[rsp], 0

; 9    : 	DWORD ret_len=0;

  00011	c7 44 24 48 00
	00 00 00	 mov	 DWORD PTR ret_len$[rsp], 0

; 10   : 	DeviceIoControl(DeviceHandle,CTL_CODE_GEN(0x801),&index,4,&msr_value,8,&ret_len,NULL);

  00019	48 c7 44 24 38
	00 00 00 00	 mov	 QWORD PTR [rsp+56], 0
  00022	48 8d 44 24 48	 lea	 rax, QWORD PTR ret_len$[rsp]
  00027	48 89 44 24 30	 mov	 QWORD PTR [rsp+48], rax
  0002c	c7 44 24 28 08
	00 00 00	 mov	 DWORD PTR [rsp+40], 8
  00034	48 8d 44 24 40	 lea	 rax, QWORD PTR msr_value$[rsp]
  00039	48 89 44 24 20	 mov	 QWORD PTR [rsp+32], rax
  0003e	41 b9 04 00 00
	00		 mov	 r9d, 4
  00044	4c 8d 44 24 60	 lea	 r8, QWORD PTR index$[rsp]
  00049	ba 04 20 22 00	 mov	 edx, 2236420		; 00222004H
  0004e	48 8b 0d 00 00
	00 00		 mov	 rcx, QWORD PTR DeviceHandle
  00055	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_DeviceIoControl

; 11   : 	return msr_value;

  0005b	48 8b 44 24 40	 mov	 rax, QWORD PTR msr_value$[rsp]

; 12   : }

  00060	48 83 c4 58	 add	 rsp, 88			; 00000058H
  00064	c3		 ret	 0
vtc_rdmsr ENDP
_TEXT	ENDS
END
